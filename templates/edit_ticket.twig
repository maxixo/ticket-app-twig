{% extends "layout.twig" %}
{% block title %}Edit Ticket - TicketFlow{% endblock %}

{% block content %}
<div style="min-height:100vh;background-color:#f9fafb;">
  
  <!-- Navbar -->
  <nav style="background:white;box-shadow:0 2px 4px rgba(0,0,0,0.1);border-bottom:1px solid #e5e7eb;">
    <div style="max-width:1200px;margin:0 auto;padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;">
      <h1 style="font-size:1.5rem;font-weight:700;color:#2563eb;">TicketFlow</h1>
      <div style="display:flex;gap:1.5rem;">
        <a href="/dashboard" 
           style="color:#4b5563;font-weight:600;text-decoration:none;transition:color 0.2s;"
           onmouseover="this.style.color='#1f2937';"
           onmouseout="this.style.color='#4b5563';">
           Dashboard
        </a>
        <a href="/tickets" 
           style="color:#4b5563;font-weight:600;text-decoration:none;transition:color 0.2s;"
           onmouseover="this.style.color='#1f2937';"
           onmouseout="this.style.color='#4b5563';">
           Tickets
        </a>
        <a href="/auth/logout" 
           style="color:#dc2626;font-weight:600;text-decoration:none;transition:color 0.2s;"
           onmouseover="this.style.color='#b91c1c';"
           onmouseout="this.style.color='#dc2626';">
           Logout
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div style="max-width:800px;margin:2rem auto;padding:2rem;background:white;border-radius:1rem;box-shadow:0 4px 8px rgba(0,0,0,0.1);">
    <h2 style="font-size:1.875rem;font-weight:700;margin-bottom:0.5rem;color:#1f2937;text-align:center;">Edit Ticket</h2>
    <p style="text-align:center;color:#6b7280;margin-bottom:2rem;">Update ticket details and status</p>

    {% if errors %}
    <div style="background-color:#fee2e2;color:#991b1b;padding:1rem;border-radius:0.5rem;margin-bottom:1.5rem;border-left:4px solid #dc2626;">
      <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
        <span style="font-size:1.25rem;">âš ï¸</span>
        <strong>Please fix the following errors:</strong>
      </div>
      <ul style="margin:0.5rem 0 0 2rem;padding:0;">
        {% for field, error in errors %}
          <li style="margin:0.25rem 0;">{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <!-- Ticket Metadata -->
    <div style="background-color:#f3f4f6;padding:1rem;border-radius:0.5rem;border-left:4px solid #2563eb;margin-bottom:1.5rem;">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;">
        <div>
          <p style="font-size:0.75rem;color:#6b7280;margin:0;text-transform:uppercase;letter-spacing:0.05em;">Ticket ID</p>
          <p style="font-size:0.875rem;font-weight:600;color:#1f2937;margin:0.25rem 0 0 0;">{{ ticket.id }}</p>
        </div>
        <div>
          <p style="font-size:0.75rem;color:#6b7280;margin:0;text-transform:uppercase;letter-spacing:0.05em;">Created</p>
          <p style="font-size:0.875rem;font-weight:600;color:#1f2937;margin:0.25rem 0 0 0;">{{ ticket.created_at }}</p>
        </div>
        {% if ticket.updated_at %}
        <div>
          <p style="font-size:0.75rem;color:#6b7280;margin:0;text-transform:uppercase;letter-spacing:0.05em;">Last Updated</p>
          <p style="font-size:0.875rem;font-weight:600;color:#1f2937;margin:0.25rem 0 0 0;">{{ ticket.updated_at }}</p>
        </div>
        {% endif %}
      </div>
    </div>

    <form method="POST" action="/tickets/update" style="display:flex;flex-direction:column;gap:1.5rem;">
      <input type="hidden" name="id" value="{{ ticket.id }}"/>

      <!-- Title -->
      <div>
        <label style="display:block;font-weight:600;color:#374151;margin-bottom:0.5rem;font-size:0.875rem;">
          Ticket Title <span style="color:#dc2626;">*</span>
        </label>
        <input 
          type="text" 
          name="title" 
          required 
          value="{{ ticket.title }}"
          placeholder="e.g., Unable to login to account"
          style="width:100%;padding:0.875rem;border:2px solid {% if errors.title %}#dc2626{% else %}#d1d5db{% endif %};border-radius:0.5rem;font-size:1rem;color:#111827;outline:none;box-sizing:border-box;transition:border-color 0.2s;"
          onfocus="this.style.borderColor='#2563eb';"
          onblur="this.style.borderColor='{% if errors.title %}#dc2626{% else %}#d1d5db{% endif %}';">
        {% if errors.title %}
          <p style="color:#dc2626;font-size:0.875rem;margin-top:0.5rem;display:flex;align-items:center;gap:0.25rem;">
            <span>âŒ</span> {{ errors.title }}
          </p>
        {% else %}
          <p style="color:#6b7280;font-size:0.75rem;margin-top:0.5rem;">Must contain at least 3 words</p>
        {% endif %}
      </div>

      <!-- Description -->
      <div>
        <label style="display:block;font-weight:600;color:#374151;margin-bottom:0.5rem;font-size:0.875rem;">
          Description <span style="color:#dc2626;">*</span>
        </label>
        <textarea 
          name="description" 
          required 
          rows="6"
          placeholder="Provide a detailed description of the issue or request..."
          style="width:100%;padding:0.875rem;border:2px solid {% if errors.description %}#dc2626{% else %}#d1d5db{% endif %};border-radius:0.5rem;font-size:1rem;color:#111827;resize:vertical;outline:none;box-sizing:border-box;transition:border-color 0.2s;font-family:inherit;"
          onfocus="this.style.borderColor='#2563eb';"
          onblur="this.style.borderColor='{% if errors.description %}#dc2626{% else %}#d1d5db{% endif %}';">{{ ticket.description }}</textarea>
        {% if errors.description %}
          <p style="color:#dc2626;font-size:0.875rem;margin-top:0.5rem;display:flex;align-items:center;gap:0.25rem;">
            <span>âŒ</span> {{ errors.description }}
          </p>
        {% else %}
          <p style="color:#6b7280;font-size:0.75rem;margin-top:0.5rem;">Provide detailed information about the ticket</p>
        {% endif %}
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
        <!-- Status -->
        <div>
          <label style="display:block;font-weight:600;color:#374151;margin-bottom:0.5rem;font-size:0.875rem;">
            Status <span style="color:#dc2626;">*</span>
          </label>
          <select 
            name="status" 
            required
            style="width:100%;padding:0.875rem;border:2px solid {% if errors.status %}#dc2626{% else %}#d1d5db{% endif %};border-radius:0.5rem;font-size:1rem;color:#111827;background:white;outline:none;box-sizing:border-box;transition:border-color 0.2s;cursor:pointer;"
            onfocus="this.style.borderColor='#2563eb';"
            onblur="this.style.borderColor='{% if errors.status %}#dc2626{% else %}#d1d5db{% endif %}';">
            <option value="open" {% if ticket.status == 'open' %}selected{% endif %}>ğŸŸ¢ Open</option>
            <option value="in_progress" {% if ticket.status == 'in_progress' %}selected{% endif %}>ğŸŸ¡ In Progress</option>
            <option value="closed" {% if ticket.status == 'closed' %}selected{% endif %}>âš« Closed</option>
          </select>
          {% if errors.status %}
            <p style="color:#dc2626;font-size:0.875rem;margin-top:0.5rem;display:flex;align-items:center;gap:0.25rem;">
              <span>âŒ</span> {{ errors.status }}
            </p>
          {% endif %}
        </div>

        <!-- Priority -->
        <div>
          <label style="display:block;font-weight:600;color:#374151;margin-bottom:0.5rem;font-size:0.875rem;">
            Priority <span style="color:#dc2626;">*</span>
          </label>
          <select 
            name="priority" 
            required
            style="width:100%;padding:0.875rem;border:2px solid {% if errors.priority %}#dc2626{% else %}#d1d5db{% endif %};border-radius:0.5rem;font-size:1rem;color:#111827;background:white;outline:none;box-sizing:border-box;transition:border-color 0.2s;cursor:pointer;"
            onfocus="this.style.borderColor='#2563eb';"
            onblur="this.style.borderColor='{% if errors.priority %}#dc2626{% else %}#d1d5db{% endif %}';">
            <option value="low" {% if ticket.priority == 'low' %}selected{% endif %}>ğŸ”µ Low</option>
            <option value="medium" {% if ticket.priority == 'medium' %}selected{% endif %}>ğŸŸ  Medium</option>
            <option value="high" {% if ticket.priority == 'high' %}selected{% endif %}>ğŸ”´ High</option>
          </select>
          {% if errors.priority %}
            <p style="color:#dc2626;font-size:0.875rem;margin-top:0.5rem;display:flex;align-items:center;gap:0.25rem;">
              <span>âŒ</span> {{ errors.priority }}
            </p>
          {% endif %}
        </div>
      </div>

      <!-- Warning Box -->
      <div style="background-color:#fef3c7;padding:1rem;border-radius:0.5rem;border-left:4px solid #f59e0b;">
        <p style="font-size:0.875rem;color:#92400e;margin:0;display:flex;align-items:start;gap:0.5rem;">
          <span style="font-size:1.25rem;">âš ï¸</span>
          <span><strong>Note:</strong> Changes to this ticket will be saved immediately. Make sure all information is correct before submitting.</span>
        </p>
      </div>

      <!-- Buttons -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:1rem;gap:1rem;">
        <a href="/tickets"
           style="background-color:#e5e7eb;color:#374151;padding:0.875rem 2rem;border-radius:0.5rem;font-weight:600;text-decoration:none;text-align:center;flex:1;transition:background-color 0.2s;"
           onmouseover="this.style.backgroundColor='#d1d5db';"
           onmouseout="this.style.backgroundColor='#e5e7eb';">
           Cancel
        </a>

        <button type="submit"
          style="background-color:#2563eb;color:white;padding:0.875rem 2rem;border:none;border-radius:0.5rem;font-weight:600;cursor:pointer;flex:1;transition:background-color 0.2s;display:flex;align-items:center;justify-content:center;gap:0.5rem;"
          onmouseover="this.style.backgroundColor='#1d4ed8';"
          onmouseout="this.style.backgroundColor='#2563eb';">
          <span>ğŸ’¾</span> Save Changes
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}