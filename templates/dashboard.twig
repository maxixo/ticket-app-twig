{% extends "layout.twig" %}
{% block title %}Dashboard - TicketFlow{% endblock %}

{% block content %}
<div style="min-height:100vh;background-color:#f9fafb;">

  <!-- Navbar -->
  <nav style="background:white;box-shadow:0 2px 4px rgba(0,0,0,0.1);border-bottom:1px solid #e5e7eb;">
    <div style="max-width:1200px;margin:0 auto;padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;">
      <h1 style="font-size:1.5rem;font-weight:700;color:#2563eb;">TicketFlow</h1>
      <div style="display:flex;gap:1rem;">
        <a href="/auth/logout?redirect=/" 
           style="color:#dc2626;font-weight:600;text-decoration:none;"
           onmouseover="this.style.color='#b91c1c';" 
           onmouseout="this.style.color='#dc2626';">
           Logout
        </a>
      </div>
    </div>
  </nav>

  <!-- Dashboard Content -->
  <div style="max-width:1200px;margin:0 auto;padding:2rem 1rem;">
    <h2 style="font-size:2rem;font-weight:700;margin-top:2rem;margin-bottom:2rem;color:#1f2937;">Dashboard</h2>

    <!-- Stats Section -->
    <div id="stats" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem;">
      <div style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 2px 4px rgba(0,0,0,0.1);text-align:center;">
        <p style="color:#6b7280;font-size:0.875rem;margin-bottom:0.25rem;">Total Tickets</p>
        <h2 style="font-size:2rem;font-weight:700;color:#2563eb;">{{ total }}</h2>
      </div>
      <div style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 2px 4px rgba(0,0,0,0.1);text-align:center;">
        <p style="color:#6b7280;font-size:0.875rem;margin-bottom:0.25rem;">Open</p>
        <h2 style="font-size:2rem;font-weight:700;color:#16a34a;">{{ open }}</h2>
      </div>
      <div style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 2px 4px rgba(0,0,0,0.1);text-align:center;">
        <p style="color:#6b7280;font-size:0.875rem;margin-bottom:0.25rem;">In Progress</p>
        <h2 style="font-size:2rem;font-weight:700;color:#ca8a04;">{{ inProgress }}</h2>
      </div>
      <div style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 2px 4px rgba(0,0,0,0.1);text-align:center;">
        <p style="color:#6b7280;font-size:0.875rem;margin-bottom:0.25rem;">Closed</p>
        <h2 style="font-size:2rem;font-weight:700;color:#4b5563;">{{ closed }}</h2>
      </div>
    </div>

    <!-- Completion Rate + Priority Breakdown -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;margin-bottom:2rem;">
      
      <!-- Completion Rate -->
      <div style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 4px 8px rgba(0,0,0,0.1);">
        <h3 style="font-size:1.125rem;font-weight:600;color:#1f2937;margin-bottom:1rem;">Completion Rate</h3>
        <div style="position:relative;">
          <div style="margin-bottom:0.5rem;display:flex;justify-content:space-between;align-items:center;">
            <span id="completion-rate-label" style="font-size:0.75rem;font-weight:600;color:#2563eb;">{{ completionRate }}% Complete</span>
          </div>
          <div style="overflow:hidden;height:1rem;border-radius:9999px;background-color:#e5e7eb;margin-bottom:1rem;">
            <div id="completion-bar" style="height:100%;width:{{ completionRate }}%;background:linear-gradient(to right,#3b82f6,#2563eb);transition:width 0.5s ease;"></div>
          </div>
          <p id="completion-summary" style="font-size:0.875rem;color:#4b5563;">
            {% if total > 0 %}
              {{ closed }} of {{ total }} tickets completed
            {% else %}
              No tickets available.
            {% endif %}
          </p>
        </div>
      </div>

      <!-- Priority Breakdown -->
      <div style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 4px 8px rgba(0,0,0,0.1);">
        <h3 style="font-size:1.125rem;font-weight:600;color:#1f2937;margin-bottom:1rem;">Priority Breakdown</h3>
        <div id="priority-breakdown">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
            <span style="font-size:0.875rem;color:#4b5563;">High Priority</span>
            <span style="padding:0.25rem 0.75rem;background-color:#fee2e2;color:#dc2626;border-radius:9999px;font-size:0.75rem;font-weight:600;">{{ priorityStats.high }}</span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
            <span style="font-size:0.875rem;color:#4b5563;">Medium Priority</span>
            <span style="padding:0.25rem 0.75rem;background-color:#fef9c3;color:#a16207;border-radius:9999px;font-size:0.75rem;font-weight:600;">{{ priorityStats.medium }}</span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span style="font-size:0.875rem;color:#4b5563;">Low Priority</span>
            <span style="padding:0.25rem 0.75rem;background-color:#dcfce7;color:#15803d;border-radius:9999px;font-size:0.75rem;font-weight:600;">{{ priorityStats.low }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Tickets -->
    {% if tickets|length > 0 %}
    <div id="recent-tickets" style="background:white;padding:1.5rem;border-radius:1rem;box-shadow:0 4px 8px rgba(0,0,0,0.1);margin-bottom:2rem;">
      <h3 style="font-size:1.125rem;font-weight:600;color:#1f2937;margin-bottom:1rem;">Recent Tickets</h3>
      <div id="ticket-list">
        {% for t in tickets|slice(-5, 5)|reverse %}
        <div style="display:flex;justify-content:space-between;align-items:center;padding:0.75rem 1rem;background-color:#f9fafb;border-radius:0.75rem;margin-bottom:0.5rem;">
          <div>
            <p style="font-weight:600;color:#1f2937;">{{ t.title }}</p>
            <p style="font-size:0.875rem;color:#6b7280;">Priority: {{ t.priority }}</p>
          </div>
          <span style="padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;
            {% if t.status == 'open' %}background-color:#dcfce7;color:#15803d;
            {% elseif t.status == 'in_progress' %}background-color:#fef9c3;color:#a16207;
            {% else %}background-color:#e5e7eb;color:#374151;{% endif %}">
            {{ t.status|replace({'_':' '}) }}
          </span>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Manage Buttons -->
    <a href="/tickets" 
       style="background-color:#2563eb;color:white;padding:0.75rem 1.5rem;border-radius:0.5rem;font-weight:600;text-decoration:none;display:inline-block;"
       onmouseover="this.style.backgroundColor='#1d4ed8';"
       onmouseout="this.style.backgroundColor='#2563eb';">
       Manage Tickets
    </a>
    <a href="/tickets/create"
       style="background-color:#2563eb;color:white;padding:0.75rem 1.5rem;border-radius:0.5rem;font-weight:600;text-decoration:none;display:inline-block;margin-left:1rem;">
       + New Ticket
    </a>
  </div>
</div>
{% endblock %}
